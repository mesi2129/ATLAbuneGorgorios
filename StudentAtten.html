<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students-Check-In System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: DodgerBlue;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .logo {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo-placeholder {
            height: 120px;
            width: 120px;
            background: #8B0000;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #8B0000;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 400;
        }

        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            border-color: #8B0000;
        }

        input[type="text"].dropdown-open {
            border-radius: 10px 10px 0 0;
            border-bottom-color: transparent;
        }

        .suggestions {
            position: absolute;
            top: calc(100% - 1px);
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #8B0000;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            text-align: left;
            transition: background-color 0.2s;
        }

        .suggestion-item:hover {
            background-color: #f8f9ff;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .btn-confirm {
            background: #8B0000;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 8px;
            min-width: 140px;
        }

        .btn-confirm:hover {
            background: #A61616;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2);
        }

        .btn-cancel {
            background: transparent;
            color: #666;
            border: 2px solid #ddd;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 8px;
            min-width: 140px;
        }

        .btn-cancel:hover {
            background: #f5f5f5;
            border-color: #bbb;
            color: #444;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .student-info {
            background: #f8f9ff;
            border: 1px solid #e1e1e1;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .student-info h3 {
            color: #8B0000;
            margin-bottom: 10px;
            font-size: 1.3em;
            text-align: center;
        }

        .person-details {
            text-align: left;
            margin: 15px 0;
        }

        .person-details p {
            margin: 8px 0;
            color: #555;
        }

        .person-details strong {
            color: #333;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <div class="logo-placeholder">SCHOOL</div>
        </div>
        
        <h1>Students-Check-In</h1>
        
        <div class="search-container">
            <input type="text" id="nameSearch" placeholder="Start typing your name..." autocomplete="off">
            <div class="suggestions" id="suggestions"></div>
        </div>
        
        <div class="student-info" id="studentInfo">
            <h3>Please confirm this is you:</h3>
            <div class="person-details" id="personDetails"></div>
            <button class="btn-confirm" id="confirmBtn">Yes, Check Me In</button>
            <button class="btn-cancel" onclick="clearSelection()">This is not me</button>
        </div>
        
        <div class="success-message" id="successMessage">
            Successfully checked in! Welcome!
        </div>
        
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // ================================
        // EXCEL FILE CONFIGURATION
        // ================================
        // 1. Upload your Excel file to this directory
        // 2. Change the filename below to match your Excel file name
        const EXCEL_FILENAME = 'Students list 2025.xlsx'; // <-- CHANGE THIS TO YOUR EXCEL FILE NAME
        
        // 3. Configure your Excel column names below (case-sensitive)
        // If your Excel has different column names, update these:
        const COLUMN_MAPPING = {
            studentId: 'Student ID',        // Column name for Student ID
            firstName: 'First Name',       // Column name for First Name
            middleName: 'Middle Name',     // Column name for Middle Name (optional)
            lastName: 'Last name',         // Column name for Last Name                 // Column name for Grade
            bible: 'Bible Level',          // Column name for Bible Level
            level: 'Level',                // Column name for Level
            amharic: 'Amharic Level'       // Column name for Amharic Level
        };
        
        // ================================
        // DATA LOADING
        // ================================
        let members = [];
        
        // Function to load Excel file
        async function loadExcelData() {
            try {
                console.log('Attempting to load Excel file:', EXCEL_FILENAME);
                const response = await fetch(EXCEL_FILENAME);
                
                if (!response.ok) {
                    throw new Error(`Excel file not found: ${EXCEL_FILENAME}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // Get the first worksheet
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Convert to JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Map Excel columns to our format
                members = jsonData.map((row, index) => ({
                    studentId: row[COLUMN_MAPPING.studentId] || `auto_${index}`,
                    firstName: row[COLUMN_MAPPING.firstName] || '',
                    middleName: row[COLUMN_MAPPING.middleName] || '',
                    lastName: row[COLUMN_MAPPING.lastName] || '',
                    grade: row[COLUMN_MAPPING.bible] || '',
                    level: row[COLUMN_MAPPING.amharic] || '',
                    uniqueId: `member_${index}` // Add unique ID for reliable selection
                })).filter(member => member.firstName && member.lastName); // Remove empty rows
                
                console.log(`Successfully loaded ${members.length} members from Excel file`);
                console.log('Sample member:', members[0]);
                
            } catch (error) {
                console.warn('Could not load Excel file:', error.message);
                console.log('Using sample data instead');
                
                // Sample data as fallback
                members = [
                    {
                        studentId: 'STU001',
                        firstName: 'John',
                        middleName: 'Michael',
                        lastName: 'Doe',
                        grade: '10',
                        level: 'A',
                        uniqueId: 'member_0'
                    },
                    {
                        studentId: 'STU002',
                        firstName: 'Jane',
                        middleName: 'Elizabeth',
                        lastName: 'Smith',
                        grade: '11',
                        level: 'B',
                        uniqueId: 'member_1'
                    },
                    {
                        studentId: 'STU003',
                        firstName: 'Robert',
                        middleName: 'James',
                        lastName: 'Johnson',
                        grade: '9',
                        level: 'C',
                        uniqueId: 'member_2'
                    }
                ];
            }
        }

        const searchInput = document.getElementById('nameSearch');
        const suggestions = document.getElementById('suggestions');
        const studentInfo = document.getElementById('studentInfo');
        const personDetails = document.getElementById('personDetails');
        const successMessage = document.getElementById('successMessage');
        const confirmBtn = document.getElementById('confirmBtn');
        
        let selectedMember = null;
        let checkedInMembers = new Set(); // Track who has checked in

        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            
            if (query.length < 2) {
                suggestions.style.display = 'none';
                searchInput.classList.remove('dropdown-open');
                studentInfo.style.display = 'none';
                return;
            }

            const matches = members.filter(member => {
                const fullName = `${member.firstName} ${member.middleName ? member.middleName + ' ' : ''}${member.lastName}`.toLowerCase();
                const reverseName = `${member.lastName} ${member.firstName}`.toLowerCase();
                
                return fullName.includes(query) || 
                       reverseName.includes(query) ||
                       member.firstName.toLowerCase().includes(query) ||
                       member.lastName.toLowerCase().includes(query) ||
                       (member.middleName && member.middleName.toLowerCase().includes(query));
            });

            if (matches.length > 0) {
                suggestions.innerHTML = matches.map(member => {
                    const displayName = `${member.firstName} ${member.middleName ? member.middleName + ' ' : ''}${member.lastName}`;
                    return `<div class="suggestion-item" onclick="selectMember('${member.uniqueId}')">
                                <strong>${displayName}</strong><br>
                                <small>ID: ${member.studentId} | Grade: ${member.bible}</small>
                            </div>`;
                }).join('');
                
                suggestions.style.display = 'block';
                searchInput.classList.add('dropdown-open');
            } else {
                suggestions.style.display = 'none';
                searchInput.classList.remove('dropdown-open');
            }
            
            selectedMember = null;
        });

        function selectMember(uniqueId) {
            selectedMember = members.find(m => m.uniqueId === uniqueId);
            if (selectedMember) {
                const displayName = `${selectedMember.firstName} ${selectedMember.middleName ? selectedMember.middleName + ' ' : ''}${selectedMember.lastName}`;
                searchInput.value = displayName;
                suggestions.style.display = 'none';
                searchInput.classList.remove('dropdown-open');
                showStudentInfo();
            }
        }

        function showStudentInfo() {
            if (!selectedMember) return;
            
            const alreadyCheckedIn = isAlreadyCheckedIn(selectedMember.studentId);
            const statusText = alreadyCheckedIn ? 
                '<p style="color: #28a745; font-weight: bold;">✅ Already Checked In</p>' : 
                '<p style="color: #ffc107; font-weight: bold;">⏳ Not Checked In</p>';
            
            const displayName = `${selectedMember.firstName} ${selectedMember.middleName ? selectedMember.middleName + ' ' : ''}${selectedMember.lastName}`;
            
            personDetails.innerHTML = `
                <p><strong>Student ID:</strong> ${selectedMember.studentId || 'N/A'}</p>
                <p><strong>Name:</strong> ${displayName}</p>
                <p><strong>Grade:</strong> ${selectedMember.bible || 'N/A'}</p>
                <p><strong>Level:</strong> ${selectedMember.amharic || 'N/A'}</p>
                ${statusText}
            `;
            
            // Update button states
            if (alreadyCheckedIn) {
                confirmBtn.disabled = true;
                confirmBtn.textContent = 'Already Checked In';
                confirmBtn.style.opacity = '0.6';
            } else {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'Yes, Check Me In';
                confirmBtn.style.opacity = '1';
            }
            
            studentInfo.style.display = 'block';
        }

        function confirmCheckIn() {
            if (!selectedMember) return;
            
            const fullName = `${selectedMember.firstName} ${selectedMember.middleName ? selectedMember.middleName + ' ' : ''}${selectedMember.lastName}`;
            const checkInData = {
                studentId: selectedMember.studentId,
                name: fullName,
                grade: selectedMember.bible || 'N/A',
                level: selectedMember.amharic || 'N/A',
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString()
            };
            
            // Save locally
            let localCheckIns = JSON.parse(localStorage.getItem('studentCheckIns') || '[]');
            localCheckIns.push(checkInData);
            localStorage.setItem('studentCheckIns', JSON.stringify(localCheckIns));
            
            // Add to local tracking for immediate UI updates
            checkedInMembers.add(selectedMember.studentId);
            
            studentInfo.style.display = 'none';
            successMessage.style.display = 'block';
            
            // Reset form after 3 seconds
            setTimeout(() => {
                clearForm();
            }, 3000);
        }

        function clearSelection() {
            studentInfo.style.display = 'none';
            selectedMember = null;
        }

        function clearForm() {
            searchInput.value = '';
            studentInfo.style.display = 'none';
            successMessage.style.display = 'none';
            suggestions.style.display = 'none';
            searchInput.classList.remove('dropdown-open');
            selectedMember = null;
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                suggestions.style.display = 'none';
                searchInput.classList.remove('dropdown-open');
            }
        });

        // Handle enter key
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && selectedMember) {
                confirmCheckIn();
            }
        });

        // Load existing check-ins from localStorage
        function loadExistingCheckIns() {
            const localCheckIns = JSON.parse(localStorage.getItem('studentCheckIns') || '[]');
            checkedInMembers.clear();
            localCheckIns.forEach(checkIn => {
                checkedInMembers.add(checkIn.studentId);
            });
            console.log(`Loaded ${checkedInMembers.size} check-ins from localStorage`);
        }

        // Check if student is already checked in
        function isAlreadyCheckedIn(studentId) {
            return checkedInMembers.has(studentId);
        }

        // Initialize the application
        async function initializeApp() {
            // Load Excel data
            await loadExcelData();
            
            // Load existing check-ins
            loadExistingCheckIns();
            
            // Set up event listener for confirm button
            confirmBtn.addEventListener('click', confirmCheckIn);
            
            console.log('Application initialized successfully');
        }

        // Start the application when page loads
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>
